// B9 HX MFT/RF patch

// MFT Tank Definitions {{{
+TANK_DEFINITION[Default]:NEEDS[modularFuelTanks]:Final {
    @name = B9_HX
    %basemass = 0.000508761 * volume
    %baseCost = 0
    @TANK[LiquidFuel] {
        %mass = 0.000095376
        %cost = 0.289017341
    }
    @TANK[Oxidizer] {
        %mass = 0.000153179
        %cost = 0.289017341
    }
    @TANK[MonoPropellant] {
        %mass = 0.000063584
        %cost = 0.0867052
    }
}

+TANK_DEFINITION[B9_Rocket]:NEEDS[modularFuelTanks]:Final {
    @name = B9_HX_Universal
    %TANK[ElectricCharge] {
        %mass = 0.000936416
        %cost = 1
        %amount = 0
        %maxAmount = 0
        %utilization = 18.84
    }
}
/// }}}


// MFT Part Definitions {{{

// Globals {{{
@PART[B9_Structure_HX*]:HAS[@MODULE[FSfuelSwitch]&!MODULE[FSmeshSwitch]&!MODULE[FStextureSwitch2]]:FOR[B9_Aerospace_HX]:NEEDS[modularFuelTanks|RealFuels] {
    @title ^= : \(x\d*\)::
    @description ^= :CONTAINS \d* SUBTYPES \| ::
}
// }}}

// HX System {{{

// HX Side {{{
@PART[B9_Structure_HX_S_2]:FOR[B9_Aerospace_HX]:NEEDS[modularFuelTanks|RealFuels] {
    @MODULE[FSmeshSwitch] {
        @useFuelSwitchModule = false
    }
    !MODULE[FSfuelSwitch] {}
    MODULE {
        name = ModuleFuelTanks
        volume = 340
        type = B9_HX
    }
}

@PART[B9_Structure_HX_S_8]:FOR[B9_Aerospace_HX]:NEEDS[modularFuelTanks|RealFuels] {
    @MODULE[FSmeshSwitch] {
        @useFuelSwitchModule = false
    }
    !MODULE[FSfuelSwitch] {}
    MODULE {
        name = ModuleFuelTanks
        volume = 1380
        type = B9_HX
    }
}
// }}}

// HX0 {{{
@PART[B9_Structure_HX0_E]:FOR[B9_Aerospace_HX]:NEEDS[modularFuelTanks|RealFuels] {
    !MODULE[FSfuelSwitch] {}
    MODULE {
        name = ModuleFuelTanks
        volume = 8820
        type = B9_HX
    }
}

@PART[B9_Structure_HX0_S]:FOR[B9_Aerospace_HX]:NEEDS[modularFuelTanks|RealFuels] {
    !MODULE[FSfuelSwitch] {}
    MODULE {
        name = ModuleFuelTanks
        volume = 26640
        type = B9_HX_Universal
    }
}
// }}}

// HX1 {{{
@PART[B9_Structure_HX1_A_375B]:FOR[B9_Aerospace_HX]:NEEDS[modularFuelTanks|RealFuels] {
    !MODULE[FSfuelSwitch] {}
    MODULE {
        name = ModuleFuelTanks
        volume = 22500
        type = B9_HX
    }
}

@PART[B9_Structure_HX1_A_375C]:FOR[B9_Aerospace_HX]:NEEDS[modularFuelTanks|RealFuels] {
    @title ^= : \(x4\): (x2):
    @description ^= :CONTAINS 4 SUBTYPES:CONTAINS 2 SUBTYPES:
    @MODULE[FSmeshSwitch] {
        @objectDisplayNames = Type A; Type B
        @objects = STR1; STR2
        @useFuelSwitchModule = false
    }
    !MODULE[FSfuelSwitch] {}
    MODULE {
        name = ModuleFuelTanks
        volume = 4340
        type = B9_HX
    }
}

@PART[B9_Structure_HX1_A_LLL]:FOR[B9_Aerospace_HX]:NEEDS[modularFuelTanks|RealFuels] {
    !MODULE[FSfuelSwitch] {}
    MODULE {
        name = ModuleFuelTanks
        volume = 15247
        type = B9_HX
    }
}

@PART[B9_Structure_HX1_A_P]:FOR[B9_Aerospace_HX]:NEEDS[modularFuelTanks|RealFuels] {
    !MODULE[FSfuelSwitch] {}
    MODULE {
        name = ModuleFuelTanks
        volume = 18340
        type = B9_HX
    }
}

@PART[B9_Structure_HX1_A_SD]:FOR[B9_Aerospace_HX]:NEEDS[modularFuelTanks|RealFuels] {
    @title ^= : \(x4\): (x2):
    @description ^= :CONTAINS 4 SUBTYPES:CONTAINS 2 SUBTYPES:
    @MODULE[FSmeshSwitch] {
        @objectDisplayNames = Type A; Type B
        @objects = STR1; STR2
        @useFuelSwitchModule = false
    }
    !MODULE[FSfuelSwitch] {}
    MODULE {
        name = ModuleFuelTanks
        volume = 64040
        type = B9_HX
    }
}

@PART[B9_Structure_HX1_A_S0]:FOR[B9_Aerospace_HX]:NEEDS[modularFuelTanks|RealFuels] {
    !MODULE[FSfuelSwitch] {}
    MODULE {
        name = ModuleFuelTanks
        volume = 42860
        type = B9_HX
    }
}

@PART[B9_Structure_HX1_E1]:FOR[B9_Aerospace_HX]:NEEDS[modularFuelTanks|RealFuels] {
    !MODULE[FSfuelSwitch] {}
    MODULE {
        name = ModuleFuelTanks
        volume = 39280
        type = B9_HX
    }
}

@PART[B9_Structure_HX1_S_HS]:FOR[B9_Aerospace_HX]:NEEDS[modularFuelTanks|RealFuels] {
    !MODULE[FSfuelSwitch] {}
    MODULE {
        name = ModuleFuelTanks
        volume = 3580
        type = B9_HX_Universal
    }
}

@PART[B9_Structure_HX1_S_T]:FOR[B9_Aerospace_HX]:NEEDS[modularFuelTanks|RealFuels] {
    !MODULE[FSfuelSwitch] {}
    MODULE {
        name = ModuleFuelTanks
        volume = 29500
        type = B9_HX
    }
}

@PART[B9_Structure_HX1_U]:FOR[B9_Aerospace_HX]:NEEDS[modularFuelTanks|RealFuels] {
    @MODULE[FSmeshSwitch] {
        @useFuelSwitchModule = false
    }
    !MODULE[FSfuelSwitch] {}
    MODULE {
        name = ModuleFuelTanks
        volume = 59000
        type = B9_HX_Universal
    }
}

@PART[B9_Structure_HX1_U_S]:FOR[B9_Aerospace_HX]:NEEDS[modularFuelTanks|RealFuels] {
    @MODULE[FSmeshSwitch] {
        @useFuelSwitchModule = false
    }
    !MODULE[FSfuelSwitch] {}
    MODULE {
        name = ModuleFuelTanks
        volume = 14740
        type = B9_HX_Universal
    }
}
// }}}

// HX2 {{{
@PART[B9_Structure_HX2_A_S1_A]:FOR[B9_Aerospace_HX]:NEEDS[modularFuelTanks|RealFuels] {
    !MODULE[FSfuelSwitch] {}
    MODULE {
        name = ModuleFuelTanks
        volume = 91260
        type = B9_HX
    }
}

@PART[B9_Structure_HX2_A_S1_B]:FOR[B9_Aerospace_HX]:NEEDS[modularFuelTanks|RealFuels] {
    !MODULE[FSfuelSwitch] {}
    MODULE {
        name = ModuleFuelTanks
        volume = 182520
        type = B9_HX
    }
}

@PART[B9_Structure_HX2_U]:FOR[B9_Aerospace_HX]:NEEDS[modularFuelTanks|RealFuels] {
    @MODULE[FSmeshSwitch] {
        @useFuelSwitchModule = false
    }
    !MODULE[FSfuelSwitch] {}
    MODULE {
        name = ModuleFuelTanks
        volume = 123520
        type = B9_HX_Universal
    }
}
// }}}

// HX4 {{{
@PART[B9_Structure_HX4_A_HX1_A]:FOR[B9_Aerospace_HX]:NEEDS[modularFuelTanks|RealFuels] {
    !MODULE[FSfuelSwitch] {}
    MODULE {
        name = ModuleFuelTanks
        volume = 142440
        type = B9_HX
    }
}

@PART[B9_Structure_HX4_A_HX2_A]:FOR[B9_Aerospace_HX]:NEEDS[modularFuelTanks|RealFuels] {
    !MODULE[FSfuelSwitch] {}
    MODULE {
        name = ModuleFuelTanks
        volume = 186500
        type = B9_HX
    }
}

@PART[B9_Structure_HX4_A_HX2_B]:FOR[B9_Aerospace_HX]:NEEDS[modularFuelTanks|RealFuels] {
    !MODULE[FSfuelSwitch] {}
    MODULE {
        name = ModuleFuelTanks
        volume = 376520
        type = B9_HX
    }
}

@PART[B9_Structure_HX4_U]:FOR[B9_Aerospace_HX]:NEEDS[modularFuelTanks|RealFuels] {
    @MODULE[FSmeshSwitch] {
        @useFuelSwitchModule = false
    }
    !MODULE[FSfuelSwitch] {}
    MODULE {
        name = ModuleFuelTanks
        volume = 252600
        type = B9_HX_Universal
    }
}
// }}}

// }}}





// RealFuels Tank Types {{{
+TANK_DEFINITION[ServiceModule]:NEEDS[RealFuels]:Final {
    @name = B9_HX_Universal
    @basemass = 0.000008 * volume
}
+TANK_DEFINITION[B9_HX_Universal]:NEEDS[RealFuels]:Final {
    @name = B9_HX
    !TANK[ElectricCharge] {}
}
// }}}

// RealFuels Part Definitions {{{

// Globals {{{
@PART[B9_Structure_HX_*]:FOR[B9_Aerospace_HX]:HAS[@MODULE[ModuleFuelTanks]&~CrewCapacity[]]:NEEDS[RealFuels] {
    @MODULE[ModuleFuelTanks] {
        @volume *= 5
    }
    @MODULE[ModuleFuelTanks]:HAS[#type[B9_Rocket]] {
        !typeAvailable = DELETE
    }
}
// }}}


// HX Hangar mass/cost scaling {{{
@PART[B9_Structure_HX1_H]:FOR[B9_Aerospace]:NEEDS[RealFuels] {
    @cost *= 0.05767
    @mass *= 0.078637
    @MODULE[FSfuelSwitch] {
        @basePartMass *= 0.078637
        @tankMass = 0.3428; 0.2737; 0.1824; 0.0912; 0
    }
}
@PART[B9_Structure_HX2_H]:FOR[B9_Aerospace]:NEEDS[RealFuels] {
    @cost *= 0.05767
    @mass *= 0.078637
    @MODULE[FSfuelSwitch] {
        @basePartMass *= 0.078637
        @tankMass = 0.7423; 0.5599; 0.4624; 0.1824; 0
    }
}
@PART[B9_Structure_HX4_H]:FOR[B9_Aerospace]:NEEDS[RealFuels] {
    @cost *= 0.05767
    @mass *= 0.078637
    @MODULE[FSfuelSwitch] {
        @basePartMass *= 0.078637
        @tankMass = 0.8855; 0.8406; 0.5607; 0.2807; 0
    }
}
// }}}

// }}}