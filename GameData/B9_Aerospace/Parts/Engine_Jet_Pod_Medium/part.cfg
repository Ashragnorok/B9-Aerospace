PART
{
    // --- general parameters ---
    name = B9_Engine_Jet_Pod_Medium
    module = Part
    author = bac9-flcl (textures), Taverius (model)

    // --- asset parameters ---
    mesh = model.mu
    rescaleFactor = 1.13137
    scale = 1.0

    // --- node definitions ---
    node_stack_top = 0.0, 0.0, -0.639, 0.0, 0.0, -1.0, 1

    // --- editor parameters ---
    TechRequired = heavyAerodynamics
    entryCost = 4950
    cost = 1650
    category = Engine
    subcategory = 0
    title = CF34 Turbofan Engine
    manufacturer = Tetragon Projects
    description = Powerful and reliable high-bypass subsonic turbofan, one of the most popular designs in it's class. Capable of performing wide variety of tasks with extreme efficiency, from powering heavy transport aircraft and large crew transports to use in mothership launch platforms. Max Design Speed: Mach 0.95. Effective Intake Area: 0.0102

    // attachment rules: stack, srfAttach, allowStack, allowSrfAttach, allowCollision
    attachRules = 1,0,0,1,0

    // --- standard part parameters ---
    mass = 0.815
    dragModelType = default
    maximum_drag = 0.2
    minimum_drag = 0.2
    angularDrag = 2
    crashTolerance = 7
    breakingForce = 2000
    breakingTorque = 2000
    maxTemp = 2000 // = 3600
	emissiveConstant = 0.8
	bulkheadProfiles = size1

    EFFECTS
    {
        power
        {
            AUDIO
            {
                channel = Ship
                clip = sound_jet_deep
                volume = 0   0    0     25
                volume = 0.1 1.12 0.145 0.145
                volume = 1.0 1.25 0.145 0
                pitch = 0 0.3
                pitch = 1 1
                loop = true
            }
        }
        running
        {
            MODEL_MULTI_PARTICLE_PERSIST
            {
                name = b9_jet_cf34_smoke
                modelName = B9_Aerospace/FX/HR/smokejet
                transformName = thrust_transform
                speed = 0.0 0.8
                speed = 1.0 1
                size = 0.75

                emission
                {
                    power = 0.07 0 0 0
                    power = 0.2 0.4 2.91 2.91
                    power = 1.0 1.1 0 0
                    density = 0.001 0 0 0
                    density = 0.002 1 0 0
                }

                energy
                {
                    power = 0 0.2
                    power = 1 3.2
                    externaltemp = -10 1
                    externaltemp = 1 0
                    mach = 0 1
                    mach = 10 10
                }

                offset
                {
                    mach = 0 1
                    mach = 6 10
                }

                logGrow
                {
                    density = 0 2
                    density = 1 0.9
                    density = 10 0
                }
            }

            AUDIO
            {
                channel = Ship
                clip = sound_jet_low
                volume = 0   0    0    25
                volume = 0.1 1.12 0.22 0.22
                volume = 1   1.32 0.22 0
                pitch = 0 0.3
                pitch = 1 1
                loop = true
            }
        }
        engage
        {
            AUDIO
            {
                channel = Ship
                clip = sound_vent_medium
                volume = 1
                pitch = 2
                loop = false
            }
        }
        disengage
        {
            AUDIO
            {
                channel = Ship
                clip = sound_vent_soft
                volume = 1
                pitch = 2
                loop = false
            }
        }
        flameout
        {
            PREFAB_PARTICLE
            {
                prefabName = fx_exhaustSparks_flameout_2
                transformName = thrust_transform
                oneShot = true
                localOffset = 0, 0, 0.9
            }

            AUDIO
            {
                channel = Ship
                clip = sound_explosion_low
                volume = 1
                pitch = 2
                loop = false
            }
        }
        doorMotor
        {
            AUDIO
            {
                channel = Ship
                clip = B9_Aerospace/Sounds/sound_gearRetract
                volume = 0 0
                volume = 1 1
                pitch = 0 0
                pitch = 1 1
                loop = false
            }
        }
    }

    MODULE
    {
        name = ModuleEnginesFX
        engineID = Jet
        thrustVectorTransformName = thrust_transform
        exhaustDamage = False
        ignitionThreshold = 0.1
        minThrust = 0
        maxThrust = 164
        heatProduction = 50
        useEngineResponseTime = True
        engineAccelerationSpeed = 0.30
        engineDecelerationSpeed = 0.45
        useVelocityCurve = False
        EngineType = Turbine
		PROPELLANT
        {
            name = LiquidFuel
            ratio = 1
            DrawGauge = True
        }
        PROPELLANT
        {
            name = IntakeAir
            ignoreForIsp = True
			ratio = 105
        }
        atmosphereCurve
        {
           key = 0 21000 0 0
        }
        atmChangeFlow = True
		useVelCurve = True
		useAtmCurve = True
		machLimit = 0.75
		machHeatMult = 3.5
		velCurve
		{
			key = 0 1 0 -0.125804
			key = 0.2 0.98 0 0
			key = 0.6 1 0.2399533 0.2399533
			key = 1.05 1.167 0.5409369 0.5409369
			key = 1.67 1.46 0 0
			key = 2.1 1 -3.49991 -3.49991
			key = 2.278022 0.496117 -3.164169 -3.164169
			key = 2.5 0 0.004306508 0
		}
		atmCurve
		{
			key = 0 0 0 0
			key = 0.15 0.45 2.448394 2.448394
			key = 0.5 0.85 0.5020669 0.5020669
			key = 1 1 1.047895 0
		}
    }
    
	

    MODULE
    {
          name = ModuleAnimateHeat
          ThermalAnim = jet_pod_medium_heat
    }

    MODULE
    {
        name = ModuleAlternator
        RESOURCE
        {
            name = ElectricCharge
            rate = 6.0
        }
    }

    RESOURCE
    {
        name = ElectricCharge
        amount = 0
        maxAmount = 0
        isTweakable = false
        hideFlow = true
    }

    MODULE
    {
        name = ModuleResourceIntake
        resourceName = IntakeAir
        checkForOxygen = true
        area = 0.0102
        intakeTransformName = intake
    }

    RESOURCE
    {
        name = IntakeAir
        amount = 0.2
        maxAmount = 0.2
    }

    MODULE
    {
        name = FSplanePropellerSpinner
        propellerName = fan_holder
        rotationSpeed = -31 // -500
        thrustRPM = -467 // -3500
        spinUpTime = 3
        useRotorDiscSwap = 0
        //rotorDiscName = fan_disc
        //blade1 = fan_blades
        //rotorDiscFadeInStart = 0.6
        //rotorDiscSpeed = -30
    }

    MODULE
    {
        name = FSanimateGeneric
        animationName = jet_pod_medium_reverser
        startEventGUIName = Enable thrust reverser
        endEventGUIName = Disable thrust reverser
        toggleActionName = Toggle thrust reverser
        customAnimationSpeed = 1.3
        layer = 2

        startRetractEffect = doorMotor
        startDeployEffect = doorMotor
    }

    MODULE
    {
        name = ModuleTestSubject

        // nowhere: 0, srf: 1, ocean: 2, atmo: 4, space: 8
        environments = 7

        useStaging = True
        useEvent = True
    }
}

@PART[B9_Engine_Jet_Pod_Medium]:NEEDS[FerramAerospaceResearch|NEAR]:Final {
    @MODULE[ModuleEnginesFX] {
        @maxThrust *= 1.5
    }
}

// IntakeAir quantity adjustment
@PART[B9_Engine_Jet_Pod_Medium] {
    @RESOURCE[IntakeAir] {
        intakeAirRatio = #$/MODULE[ModuleResourceIntake]/area$
        @intakeAirRatio /= 0.01
        @amount *= #$intakeAirRatio$
        @maxAmount *= #$intakeAirRatio$
        !intakeAirRatio = delete
    }
}

// Stock intake drag adjustement
//@PART[B9_Engine_Jet_Pod_Medium]:NEEDS[!FerramAerospaceResearch&!NEAR] {
    // Set unitScalar to default if its not present
//    @MODULE[ModuleResourceIntake]:HAS[~unitScalar[]] {
//       unitScalar = 0.2
//    }
    // set maxIntakeSpeed to default if not present
//    @MODULE[ModuleResourceIntake]:HAS[~maxIntakeSpeed[]] {
//        maxIntakeSpeed = 100
    }
//    @MODULE[ModuleResourceIntake] {
//        massRatio = #$/mass$
//        @massRatio /= 0.01
//        // area, / (mass ratio)
//        @area /= #$massRatio$
//        // default is 0.2, * sqroot(mass ratio)
//       unitScalarRatio = #$massRatio$
//        @unitScalarRatio != 0.5
//        @unitScalar *= #$unitScalarRatio$
//        // default is 100, * (unitScalar + sqroot(mass ratio)) / (unitScalar + 1)
//        maxIntakeSpeedFirst = #$unitScalar$
//        @maxIntakeSpeedFirst += #$unitScalarRatio$
//        maxIntakeSpeedSecond = #$unitScalar$
//       @maxIntakeSpeedSecond += 1
//        @maxIntakeSpeed *= #$maxIntakeSpeedFirst$
//        @maxIntakeSpeed /= #$maxIntakeSpeedSecond$
//        // cleanup variables
//        !massRatio = delete
//        !unitScalarRatio = delete
//        !maxIntakeSpeedFirst = delete
//        !maxIntakeSpeedSecond = delete
//    }
//}
